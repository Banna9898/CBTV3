<?php require_once __DIR__ . '/../../includes/header.php'; require_admin(); if($_SERVER['REQUEST_METHOD']==='POST'){ $title=trim($_POST['title']); $topic_id = empty($_POST['topic_id'])?null:intval($_POST['topic_id']); $time_limit=intval($_POST['time_limit']); if(!empty($title)){ $pdo->prepare('INSERT INTO exams (topic_id,title,description,time_limit) VALUES (?,?,?,?)')->execute([$topic_id,$title,trim($_POST['description']),$time_limit]); header('Location: /admin/exams.php'); exit; } } if(isset($_GET['delete'])){ $pdo->prepare('DELETE FROM exams WHERE id=?')->execute([intval($_GET['delete'])]); header('Location: /admin/exams.php'); exit; } $exams=$pdo->query('SELECT exams.*, topics.name as topic_name FROM exams LEFT JOIN topics ON exams.topic_id=topics.id ORDER BY created_at DESC')->fetchAll(PDO::FETCH_ASSOC); $topics=$pdo->query('SELECT id,name FROM topics ORDER BY name')->fetchAll(PDO::FETCH_ASSOC); ?>
<h3>Exams</h3>
<table class="table"><thead><tr><th>Title</th><th>Topic</th><th>Time</th><th>Actions</th></tr></thead><tbody>
<?php foreach($exams as $e): ?>
<tr><td><?php echo e($e['title']); ?></td><td><?php echo e($e['topic_name']); ?></td><td><?php echo e($e['time_limit']); ?></td><td><a class="btn btn-sm btn-outline-secondary" href="/admin/questions.php?exam_id=<?php echo $e['id']; ?>">Questions</a> <a class="btn btn-sm btn-danger" href="?delete=<?php echo $e['id']; ?>" onclick="return confirm('Delete?')">Delete</a></td></tr>
<?php endforeach; ?>
</tbody></table>
<form method="post" class="mt-3"><div class="form-row"><div class="col"><input name="title" class="form-control" placeholder="Exam title" required></div><div class="col"><input name="time_limit" type="number" class="form-control" value="30"></div></div><div class="form-group mt-2"><select name="topic_id" class="form-control"><option value="">-- Topic --</option><?php foreach($topics as $t) echo "<option value='{$t['id']}'>".e($t['name'])."</option>"; ?></select></div><div class="form-group"><textarea name="description" class="form-control" placeholder="Description"></textarea></div><button class="btn btn-primary">Create Exam</button></form>
<?php require_once __DIR__ . '/../../includes/footer.php'; ?>